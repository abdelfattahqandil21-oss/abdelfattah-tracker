<app-header title="Tasks Tracker"></app-header>

<div class="p-6 max-w-6xl mx-auto space-y-6">
  <!-- Filter Bar with View Toggle -->
  <app-tasks-filter-bar [activeFilter]="service.activeFilter()" [activeType]="service.activeType()"
    (filterChange)="onFilterChange($event)" (typeChange)="onTypeChange($event)">

    <!-- View Toggle (projected into filter bar) -->
    <div class="flex gap-1 bg-bg-app p-1 rounded-lg">
      <button (click)="viewMode.set('list')" class="px-3 py-1.5 rounded text-sm font-medium transition-colors"
        [class.bg-bg-card]="viewMode() === 'list'" [class.text-primary]="viewMode() === 'list'"
        [class.shadow-sm]="viewMode() === 'list'" [class.text-text-muted]="viewMode() !== 'list'">
        <i class="pi pi-list mr-1"></i> List
      </button>
      <button (click)="viewMode.set('kanban')" class="px-3 py-1.5 rounded text-sm font-medium transition-colors"
        [class.bg-bg-card]="viewMode() === 'kanban'" [class.text-primary]="viewMode() === 'kanban'"
        [class.shadow-sm]="viewMode() === 'kanban'" [class.text-text-muted]="viewMode() !== 'kanban'">
        <i class="pi pi-th-large mr-1"></i> Kanban
      </button>
    </div>
  </app-tasks-filter-bar>

  <!-- Stats Bar -->
  <app-tasks-stats-bar [stats]="service.stats()" />

  <!-- Quick Add -->
  <app-tasks-quick-add (taskAdded)="onTaskAdded($event)" />

  <!-- Tasks View -->
  @if (viewMode() === 'list') {
  <app-tasks-table [groups]="service.groupedByDate()" (toggle)="onToggle($event)" (delete)="onDelete($event)"
    (select)="onSelect($event)" />
  } @else {
  <app-tasks-kanban [boards]="service.kanbanBoards()" (toggle)="onToggle($event)" (delete)="onDelete($event)"
    (select)="onSelect($event)" (statusChange)="onStatusChange($event)" />
  }
</div>

<!-- Task Detail Modal -->
<app-task-detail-modal [task]="selectedTask()" (closed)="closeModal()" (toggle)="onToggle($event)"
  (delete)="onDelete($event)" />